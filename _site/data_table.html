<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.545">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Data wrangling with data.table">

<title>Stata2r - data.table</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">


</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./data_table.html">Data wrangling with <code>data.table</code></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Stata2r</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data_table.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Data wrangling with <code>data.table</code></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./fixest.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Regression analysis with <code>fixest</code></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./extras.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Other great packages</span></a>
  </div>
</li>
    </ul>
    </div>
    <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="4">
    <h2 id="toc-title">On this page</h2>
   
  <ul class="collapse">
  <li><a href="#installation" id="toc-installation" class="nav-link active" data-scroll-target="#installation">Installation</a></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#data-io" id="toc-data-io" class="nav-link" data-scroll-target="#data-io">Data I/O</a></li>
  <li><a href="#order" id="toc-order" class="nav-link" data-scroll-target="#order">Order</a></li>
  <li><a href="#subset" id="toc-subset" class="nav-link" data-scroll-target="#subset">Subset</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><code>data.table</code></h1>
</div>

<div>
  <div class="description">
    Data wrangling with <code>data.table</code>
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell">
<div class="cell-output cell-output-stderr">
<pre><code>Stata found at /Applications/Stata/StataIC.app/Contents/MacOS/StataIC</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The 'stata' engine is ready to use.</code></pre>
</div>
</div>
<p><a href="https://rdatatable.gitlab.io/data.table"><strong>data.table</strong></a> (by Matt Dowle, Arun Srinivasan <em>et. al.</em>) is a package written in C to make high-performance data wrangling tasks a breeze. Despite being incredibly powerful, it is dependency free and has a rock-solid API. <strong>data.table</strong> code reliably works decades apart.</p>
<section id="installation" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="installation">Installation</h2>
<p>Before continuing, make sure that you have installed <strong>data.table</strong>. You only have to do this once (or as often as you want to update the package).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install from CRAN</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"data.table"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Alternatively, you can install the latest development version</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("data.table", repos = "https://fastverse.r-universe.dev")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once <strong>data.table</strong> is installed, don’t forget to load it whenever you want to use it. Unlike Stata, you have to re-load a package every time you start a new R session.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data.table into our current R session</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>All of the examples in this section will use real-life 2014 New York air traffic data. You can use the following commands to import the dataset into both Stata and R.</p>
<div class="column-page-right">
<div class="split">
<div class="cell" data-collectcode="true">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>import delimited <span class="kw">using</span> <span class="co">///</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"https://raw.githubusercontent.com/Rdatatable/data.table/master/vignettes/flights14.csv"</span>, <span class="kw">clear</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&gt;     "https://raw.githubusercontent.com/Rdatatable/data.table/master/vignettes/flights14.csv", clear
(11 vars, 253,316 obs)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table) <span class="do">## Don't forget to load the library</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">=</span> <span class="fu">fread</span>(<span class="st">'https://raw.githubusercontent.com/Rdatatable/data.table/master/vignettes/flights14.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>The data looks like this</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">year</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">month</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">day</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">dep_delay</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">arr_delay</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">carrier</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">origin</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">dest</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">air_time</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">distance</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">hour</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2014</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">13</td>
<td style="text-align: left;">AA</td>
<td style="text-align: left;">JFK</td>
<td style="text-align: left;">LAX</td>
<td style="text-align: right;">359</td>
<td style="text-align: right;">2475</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: right;">2014</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-3</td>
<td style="text-align: right;">13</td>
<td style="text-align: left;">AA</td>
<td style="text-align: left;">JFK</td>
<td style="text-align: left;">LAX</td>
<td style="text-align: right;">363</td>
<td style="text-align: right;">2475</td>
<td style="text-align: right;">11</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2014</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">9</td>
<td style="text-align: left;">AA</td>
<td style="text-align: left;">JFK</td>
<td style="text-align: left;">LAX</td>
<td style="text-align: right;">351</td>
<td style="text-align: right;">2475</td>
<td style="text-align: right;">19</td>
</tr>
<tr class="even">
<td style="text-align: right;">2014</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-8</td>
<td style="text-align: right;">-26</td>
<td style="text-align: left;">AA</td>
<td style="text-align: left;">LGA</td>
<td style="text-align: left;">PBI</td>
<td style="text-align: right;">157</td>
<td style="text-align: right;">1035</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2014</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">AA</td>
<td style="text-align: left;">JFK</td>
<td style="text-align: left;">LAX</td>
<td style="text-align: right;">350</td>
<td style="text-align: right;">2475</td>
<td style="text-align: right;">13</td>
</tr>
<tr class="even">
<td style="text-align: right;">2014</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0</td>
<td style="text-align: left;">AA</td>
<td style="text-align: left;">EWR</td>
<td style="text-align: left;">LAX</td>
<td style="text-align: right;">339</td>
<td style="text-align: right;">2454</td>
<td style="text-align: right;">18</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>The <a href="https://rdatatable.gitlab.io/data.table"><strong>data.table</strong></a> package centers around <em>data.tables</em>, which are highly efficient data frames that can be manipulated using the package’s concise syntax. For example, say we have a data.table called <code>dat</code> (you can call it whatever you want). Then we can manipulate it by putting arguments into its square brackets, i.e.&nbsp;<code>dat[]</code>. The three main components of a <strong>data.table</strong> operation are <code>i</code>, <code>j</code>, and <code>by</code>, which go in the order <strong><code>dat[i, j, by]</code></strong>. Note you don’t have to specify the latter two if you’re not currently using them.</p>
<ul>
<li><strong><code>i</code></strong>, the first component, selects the rows of the data.table that you’ll be working with, like how in Stata the <code>if</code> or <code>in</code> command options let you refer to certain rows.</li>
<li><strong><code>j</code></strong>, the second component, both selects and operates on the columns of the data.table, like how in Stata the <code>keep</code> or <code>drop</code> commands select specific columns of your data, or how <code>generate</code> or <code>replace</code> create or modify columns in your data.</li>
<li><strong><code>by</code></strong>, the third component, gives the variable(s) designating groups that you’ll be doing your calculations within, like how in Stata you can precede a command with <code>bysort</code>.</li>
</ul>
<p><strong>data.table</strong> uses these simple components very flexibly. The upshot is that you can perform complicated operations in a single line of concise <strong>data.table</strong> code, which may have required multiple commands in other languages or libraries to accomplish. But even if you aren’t doing anything fancy, <strong>data.table</strong> has you covered with a stable set of functions that can be deployed on virtually any data wrangling task.</p>
<p>Like Stata, <strong>data.table</strong> also provides some special shortcut symbols for common operations. For example, <code>_N</code> in Stata is equivalent to <code>.N</code> in <strong>data.table</strong>, while <code>.(x1, x2)</code> is short for <code>list(x1, x2)</code>. We’ll see more examples in cheatsheat that follows. But we do want to quickly highlight one special symbol in particular: <strong><code>.SD</code></strong> refers to the (<strong>S</strong>)ubset of (<strong>D</strong>)ata you’re working with. This can be used to do complex within-group calculations when you have <code>by</code> specified. But more generally it’s a way to perform operations on lots of columns with one line of code. By default, <code>.SD</code> refers to all columns in the dataset (excepting those in <code>by</code>). But you can specify the columns you want with the <code>.SDcols</code> argument. Again, we’ll see a bunch of examples below.</p>
<p>Finally, <strong>data.table</strong> is extremely fast. It has long set the standard for in-memory data wrangling <a href="https://h2oai.github.io/db-benchmark">benchmarks</a> across a variety of libraries and languages. You will likely see an order(s) of magnitude performance difference as you compare the code chunks below. As a bonus for Stata users, who are used to operations changing a single dataset in memory, many <strong>data.table</strong> operations can be done <em>in-place</em>. This means that you don’t have to (re)assign the result to a new <strong>data.table</strong>. In-place modifications are also very efficient, since they will only affect the parts you’re actually changing, without wasting memory and time on the parts that aren’t being changed. Any time in the below cheat sheet you see a function with the word <code>set</code> in it, or the <code>:=</code> operator, that’s an in-place operation.</p>
</section>
<section id="data-io" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="data-io">Data I/O</h2>
<p>Like Stata’s <code>.dta</code> file format, R has its own native <code>.rds</code> storage format. (See also the <a href="http://www.fstpackage.org/"><strong>fst</strong></a> package.) However, we generally recommend that users avoid native—especially proprietary—data types since they hamper interoperability and reproducibility. We’ll hence concentrate on common open-source file types below. We’ll make an exception for <code>.dta</code> given our target audience, but we still recommend avoiding it if possible. Note that all of the examples in this section will assume generic datasets.</p>
<section id="read-and-write-.csv" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="read-and-write-.csv">Read and write .csv</h3>
<p>Single file.</p>
<div class="column-page-right">
<div class="split">
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>import delimited <span class="kw">using</span> <span class="st">"file.csv"</span>, <span class="kw">clear</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>* import delimited <span class="kw">using</span> <span class="st">"file.csv"</span>, <span class="kw">clear</span> colrange(1:2)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>* ?</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="kw">export</span> delimited <span class="kw">using</span> <span class="st">"file.csv"</span>, <span class="kw">replace</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">=</span> <span class="fu">fread</span>(<span class="st">"file.csv"</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># dat = fread("file.csv", select=c("col1","col2")) # or select=1:2</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># dat = fread("file.csv", drop=c("col3","col4")) # or drop=3:4</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(dat, <span class="st">"file.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>Read many files and append them together.</p>
<div class="column-page-right">
<div class="split">
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">local</span> files: <span class="ot">dir</span> <span class="st">"data/"</span> files <span class="st">"*.csv"</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="kw">tempfile</span> mytmpfile</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="kw">save</span> <span class="ot">`mytmpfile'</span>, <span class="kw">replace</span> empty</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> x <span class="kw">of</span> <span class="kw">local</span> files {</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">qui</span>: import delimited <span class="st">"data/`x'"</span>, <span class="kw">case</span>(<span class="kw">preserve</span>) <span class="kw">clear</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">append</span> <span class="kw">using</span> <span class="ot">`mytmpfile'</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">save</span> <span class="ot">`mytmpfile'</span>, <span class="kw">replace</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>files <span class="ot">=</span> <span class="fu">dir</span>(<span class="st">"data/"</span>, <span class="at">pattern=</span><span class="st">".csv"</span>, <span class="at">full.names=</span><span class="cn">TRUE</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">=</span> <span class="fu">rbindlist</span>(<span class="fu">lapply</span>(files, fread))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="read-and-write-.dta" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="read-and-write-.dta">Read and write .dta</h3>
<div class="column-page-right">
<div class="split">
<p><em>Note: <code>.dta</code> is Stata’s native (proprietary) filetype.</em></p>
<p><em>Note: These commands require the <a href="https://haven.tidyverse.org/"><strong>haven</strong></a> package.</em></p>
</div>
</div>
<p>Single file.</p>
<div class="column-page-right">
<div class="split">
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="st">"file.dta"</span>, <span class="kw">clear</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>* <span class="kw">use</span> <span class="st">"file.dta"</span>, <span class="kw">keep</span>(var1-var4) <span class="kw">clear</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="kw">save</span> <span class="st">"file.dta"</span>, <span class="kw">replace</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">=</span> haven<span class="sc">::</span><span class="fu">read_dta</span>(<span class="st">"file.dta"</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># dat = haven::read_dta("file.dta", col_select=var1:var4)</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">setDT</span>(dat) <span class="co"># i.e. Set as a data.table</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>haven<span class="sc">::</span><span class="fu">write_dta</span>(dat, <span class="st">"file.dta"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>Read many files and append them together.</p>
<div class="column-page-right">
<div class="split">
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>cd <span class="st">"`c(pwd)'/data"</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="kw">append</span> <span class="kw">using</span> <span class="ot">`: dir "." files "*.dta"'</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>files <span class="ot">=</span> <span class="fu">dir</span>(<span class="st">"data/"</span>, <span class="at">pattern=</span><span class="st">".dta"</span>, <span class="at">full.names=</span><span class="cn">TRUE</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">=</span> <span class="fu">rbindlist</span>(<span class="fu">lapply</span>(files, haven<span class="sc">::</span>read_dta))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="read-and-write-.parquet" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="read-and-write-.parquet">Read and write .parquet</h3>
<div class="column-page-right">
<div class="split">
<p><em>Note: Stata currently has limited support for parquet files (and Linux/Unix only).</em></p>
<p><em>Note: These commands require the <a href="https://arrow.apache.org/docs/r/"><strong>arrow</strong></a> package.</em></p>
</div>
</div>
<div class="column-page-right">
<div class="split">
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>* See: https:<span class="co">//github.com/mcaceresb/stata-parquet</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>files <span class="ot">=</span> <span class="fu">dir</span>(<span class="at">pattern =</span> <span class="st">".parquet"</span>) </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">=</span> <span class="fu">rbindlist</span>(<span class="fu">lapply</span>(files, arrow<span class="sc">::</span>read_parquet))</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># dat = rbindlist(lapply(files, arrow::read_parquet, col_select=1:10))</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write_parquet</span>(dat, <span class="at">sink =</span> <span class="st">"file.parquet"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
<section id="create-a-dataset-de-novo" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="create-a-dataset-de-novo">Create a dataset <em>de novo</em></h3>
<p>Random numbers. Note that the random seeds will be different across the two languages.</p>
<div class="column-page-right">
<div class="split">
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="dv">seed</span> 123</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="kw">obs</span> 10</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> x = <span class="dt">_n</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> <span class="fu">y</span> = rnormal()</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> z = runiform()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">=</span> <span class="fu">data.table</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">y =</span> <span class="fu">rnorm</span>(<span class="dv">10</span>), <span class="at">z =</span> <span class="fu">runif</span>(<span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>Some convenience functions for specific data types.</p>
<div class="column-page-right">
<div class="split">
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>* All combinations <span class="kw">of</span> <span class="kw">two</span> vectors (i.<span class="fu">e</span>. a <span class="kw">cross</span>-join)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="kw">obs</span> 10</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> id = <span class="dt">_n</span> <span class="kw">in</span> 1/2</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> yr = 2000 + <span class="dt">_n</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="kw">fillin</span> id yr</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> <span class="kw">if</span> id == . | yr == .</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># All combinations of two vectors (i.e. a cross-join)</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">=</span> <span class="fu">CJ</span>(<span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">yr =</span> <span class="dv">2001</span><span class="sc">:</span><span class="dv">2010</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>* Datetimes</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>* ?</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>* ?</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Datetime</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>dts <span class="ot">=</span> <span class="fu">Sys.time</span>() <span class="sc">+</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">10</span> <span class="co"># time right now ++10 seconds</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">=</span> <span class="fu">IDateTime</span>(dts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="order" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="order">Order</h2>
<section id="sort-rows" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="sort-rows">Sort rows</h3>
<div class="column-page-right">
<div class="split">
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">sort</span> air_time </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="ot">list</span> <span class="kw">in</span> 1/5</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     | year   month   day   dep_de~y   arr_de~y   carrier   origin   dest   air_time   distance   hour |
     |-------------------------------------------------------------------------------------------------|
  1. | 2014       6    20         -6         -2        US      LGA    BOS         20        184     14 |
  2. | 2014       2    21         46         40        EV      EWR    BDL         20        116      9 |
  3. | 2014       3     4         17         -4        EV      EWR    BDL         21        116     22 |
  4. | 2014       1    16         -3        -12        EV      EWR    BDL         21        116     11 |
  5. | 2014       2    19         19          0        EV      EWR    BDL         21        116      8 |
     +-------------------------------------------------------------------------------------------------+</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(dat, air_time)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    year month   day dep_delay arr_delay carrier origin   dest air_time distance  hour
   &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;int&gt;     &lt;int&gt;  &lt;char&gt; &lt;char&gt; &lt;char&gt;    &lt;int&gt;    &lt;int&gt; &lt;int&gt;
1:  2014     2    21        46        40      EV    EWR    BDL       20      116     9
2:  2014     6    20        -6        -2      US    LGA    BOS       20      184    14
3:  2014     1    16        -3       -12      EV    EWR    BDL       21      116    11
4:  2014     1    16        10        14      EV    EWR    BDL       21      116     8
5:  2014     2    19        19         0      EV    EWR    BDL       21      116     8
6:  2014     2    26        38        20      EV    EWR    BDL       21      116    23</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="kw">sort</span> air_time dest </span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="ot">list</span> <span class="kw">in</span> 1/5</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     | year   month   day   dep_de~y   arr_de~y   carrier   origin   dest   air_time   distance   hour |
     |-------------------------------------------------------------------------------------------------|
  1. | 2014       2    21         46         40        EV      EWR    BDL         20        116      9 |
  2. | 2014       6    20         -6         -2        US      LGA    BOS         20        184     14 |
  3. | 2014       6     5         16          4        EV      EWR    BDL         21        116     22 |
  4. | 2014       1    16         -3        -12        EV      EWR    BDL         21        116     11 |
  5. | 2014       1    16         10         14        EV      EWR    BDL         21        116      8 |
     +-------------------------------------------------------------------------------------------------+</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(dat, air_time, dest) </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    year month   day dep_delay arr_delay carrier origin   dest air_time distance  hour
   &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;int&gt;     &lt;int&gt;  &lt;char&gt; &lt;char&gt; &lt;char&gt;    &lt;int&gt;    &lt;int&gt; &lt;int&gt;
1:  2014     2    21        46        40      EV    EWR    BDL       20      116     9
2:  2014     6    20        -6        -2      US    LGA    BOS       20      184    14
3:  2014     1    16        -3       -12      EV    EWR    BDL       21      116    11
4:  2014     1    16        10        14      EV    EWR    BDL       21      116     8
5:  2014     2    19        19         0      EV    EWR    BDL       21      116     8
6:  2014     2    26        38        20      EV    EWR    BDL       21      116    23</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">gsort</span> -air_time</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="ot">list</span> <span class="kw">in</span> 1/5</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     | year   month   day   dep_de~y   arr_de~y   carrier   origin   dest   air_time   distance   hour |
     |-------------------------------------------------------------------------------------------------|
  1. | 2014       3     2         24         87        UA      EWR    HNL        706       4963      9 |
  2. | 2014       3     2         -1         64        HA      JFK    HNL        704       4983      8 |
  3. | 2014       3     4         -1         61        UA      EWR    HNL        697       4963      9 |
  4. | 2014       3     3        -11         75        HA      JFK    HNL        690       4983      8 |
  5. | 2014       3    22         -3         40        HA      JFK    HNL        689       4983      9 |
     +-------------------------------------------------------------------------------------------------+</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setorder</span>(dat, <span class="sc">-</span>air_time)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    year month   day dep_delay arr_delay carrier origin   dest air_time distance  hour
   &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;int&gt;     &lt;int&gt;  &lt;char&gt; &lt;char&gt; &lt;char&gt;    &lt;int&gt;    &lt;int&gt; &lt;int&gt;
1:  2014     3     2        24        87      UA    EWR    HNL      706     4963     9
2:  2014     3     2        -1        64      HA    JFK    HNL      704     4983     8
3:  2014     3     4        -1        61      UA    EWR    HNL      697     4963     9
4:  2014     3     3       -11        75      HA    JFK    HNL      690     4983     8
5:  2014     3    22        -3        40      HA    JFK    HNL      689     4983     9
6:  2014     1    26        13        58      UA    EWR    HNL      688     4963     9</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="sort-columns" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="sort-columns">Sort columns</h3>
<div class="column-page-right">
<div class="split">
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="kw">order</span> <span class="fu">month</span> <span class="fu">day</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="ot">list</span> <span class="kw">in</span> 1/5</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     | month   day   year   dep_de~y   arr_de~y   carrier   origin   dest   air_time   distance   hour |
     |-------------------------------------------------------------------------------------------------|
  1. |     1     1   2014         14         13        AA      JFK    LAX        359       2475      9 |
  2. |     1     1   2014         -3         13        AA      JFK    LAX        363       2475     11 |
  3. |     1     1   2014          2          9        AA      JFK    LAX        351       2475     19 |
  4. |     1     1   2014         -8        -26        AA      LGA    PBI        157       1035      7 |
  5. |     1     1   2014          2          1        AA      JFK    LAX        350       2475     13 |
     +-------------------------------------------------------------------------------------------------+</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setcolorder</span>(dat, <span class="fu">c</span>(<span class="st">'month'</span>,<span class="st">'day'</span>))</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   month   day  year dep_delay arr_delay carrier origin   dest air_time distance  hour
   &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;int&gt;     &lt;int&gt;  &lt;char&gt; &lt;char&gt; &lt;char&gt;    &lt;int&gt;    &lt;int&gt; &lt;int&gt;
1:     3     2  2014        24        87      UA    EWR    HNL      706     4963     9
2:     3     2  2014        -1        64      HA    JFK    HNL      704     4983     8
3:     3     4  2014        -1        61      UA    EWR    HNL      697     4963     9
4:     3     3  2014       -11        75      HA    JFK    HNL      690     4983     8
5:     3    22  2014        -3        40      HA    JFK    HNL      689     4983     9
6:     1    26  2014        13        58      UA    EWR    HNL      688     4963     9</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="rename-columns" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="rename-columns">Rename columns</h3>
<div class="column-page-right">
<div class="split">
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>* <span class="kw">rename</span> (old) (<span class="kw">new</span>) </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="kw">rename</span> arr_delay arrival_delay </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="kw">rename</span> (carrier origin) (carrier_code origin_code) </span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="kw">rename</span> arr_* arrival_*</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># setnames(dat, old = ..., new = ...) </span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="fu">setnames</span>(dat, <span class="st">'arr_delay'</span>, <span class="st">'arrival_delay'</span>) </span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="fu">setnames</span>(dat, <span class="fu">c</span>(<span class="st">'carrier'</span>,<span class="st">'origin'</span>), <span class="fu">c</span>(<span class="st">'carrier_code'</span>,<span class="st">'origin_code'</span>)) </span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="fu">setnames</span>(dat, <span class="fu">gsub</span>(<span class="st">'arr_'</span>, <span class="st">'arrival_'</span>, <span class="fu">names</span>(dat)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="subset" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="subset">Subset</h2>
<p>In newer versions of Stata, it’s possible to keep multiple datasets in memory, or “frames” as Stata calls them. But this still requires extra steps that would be unusual to users of other languages. In contrast, keeping multiple datasets in memory is extremely common in R. Moreover, subsetting and collapsing operations don’t overwrite your original dataset. The upshot is that you don’t need to wrap everything in <code>preserve/restore</code>. However, it also means that you’ll need to (re)assign your subsetted/collapsed data if you want to use it again later. E.g. <code>dat1 = dat[origin=='LGA']</code>.</p>
<section id="subset-rows" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="subset-rows">Subset rows</h3>
<div class="column-page-right">
<div class="split">
<div>
<p><em>Reminder: You’ll need to use <code>preserve/restore</code> if you want to retain the original dataset in the examples that follow.</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> <span class="kw">in</span> 1/200 </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(253,116 observations deleted)</code></pre>
</div>
</div>
</div>
<div>
<p><em>Reminder: You’ll need to (re)assign the subsetted dataset if you want to use it later, e.g.&nbsp;<code>dat1 = dat[...]</code>.</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>dat[<span class="dv">1</span><span class="sc">:</span><span class="dv">200</span>] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     month   day  year dep_delay arr_delay carrier origin   dest air_time distance  hour
     &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;int&gt;     &lt;int&gt;  &lt;char&gt; &lt;char&gt; &lt;char&gt;    &lt;int&gt;    &lt;int&gt; &lt;int&gt;
  1:     3     2  2014        24        87      UA    EWR    HNL      706     4963     9
  2:     3     2  2014        -1        64      HA    JFK    HNL      704     4983     8
  3:     3     4  2014        -1        61      UA    EWR    HNL      697     4963     9
  4:     3     3  2014       -11        75      HA    JFK    HNL      690     4983     8
  5:     3    22  2014        -3        40      HA    JFK    HNL      689     4983     9
 ---                                                                                    
196:     6     7  2014        -8        10      HA    JFK    HNL      624     4983     9
197:     9    13  2014        -2         8      HA    JFK    HNL      624     4983     9
198:     9    15  2014        -6         0      UA    EWR    HNL      624     4962     9
199:    10     4  2014         0        11      HA    JFK    HNL      624     4983    10
200:     1    12  2014         6       -20      UA    EWR    HNL      623     4963     9</code></pre>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> <span class="kw">if</span> <span class="fu">day</span> &gt; 5 &amp; <span class="fu">day</span> &lt; 10</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(219,414 observations deleted)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>dat[day <span class="sc">&gt;</span> <span class="dv">5</span> <span class="sc">&amp;</span> day <span class="sc">&lt;</span> <span class="dv">10</span>] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       month   day  year dep_delay arr_delay carrier origin   dest air_time distance  hour
       &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;int&gt;     &lt;int&gt;  &lt;char&gt; &lt;char&gt; &lt;char&gt;    &lt;int&gt;    &lt;int&gt; &lt;int&gt;
    1:     2     7  2014         8        59      HA    JFK    HNL      685     4983     9
    2:     2     9  2014         2        44      HA    JFK    HNL      675     4983     9
    3:     2     8  2014        -8        28      HA    JFK    HNL      673     4983     8
    4:     2     6  2014         1        25      UA    EWR    HNL      669     4963     9
    5:     2     7  2014        -5        10      UA    EWR    HNL      667     4963     9
   ---                                                                                    
33898:     6     8  2014        -6        -5      EV    EWR    BDL       23      116     8
33899:     9     7  2014        -9       -30      EV    EWR    BDL       23      116    22
33900:     2     6  2014        24        12      EV    EWR    BDL       22      116    12
33901:     6     6  2014        -1       -12      EV    EWR    BDL       22      116    22
33902:     9     8  2014        -5       -24      EV    EWR    BDL       22      116    21</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> <span class="kw">if</span> <span class="fu">inrange</span>(<span class="fu">day</span>,5,10)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(203,042 observations deleted)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>dat[<span class="fu">between</span>(day,<span class="dv">5</span>,<span class="dv">10</span>)] <span class="co"># Or: dat[day %in% 5:10] </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       month   day  year dep_delay arr_delay carrier origin   dest air_time distance  hour
       &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;int&gt;     &lt;int&gt;  &lt;char&gt; &lt;char&gt; &lt;char&gt;    &lt;int&gt;    &lt;int&gt; &lt;int&gt;
    1:     2     7  2014         8        59      HA    JFK    HNL      685     4983     9
    2:     2     9  2014         2        44      HA    JFK    HNL      675     4983     9
    3:     2     8  2014        -8        28      HA    JFK    HNL      673     4983     8
    4:     2     6  2014         1        25      UA    EWR    HNL      669     4963     9
    5:     2     7  2014        -5        10      UA    EWR    HNL      667     4963     9
   ---                                                                                    
50270:     2     6  2014        24        12      EV    EWR    BDL       22      116    12
50271:     6     6  2014        -1       -12      EV    EWR    BDL       22      116    22
50272:     9     8  2014        -5       -24      EV    EWR    BDL       22      116    21
50273:     6     5  2014       105        93      EV    EWR    BDL       21      116    14
50274:     6     5  2014        16         4      EV    EWR    BDL       21      116    22</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> <span class="kw">if</span> origin == <span class="st">"LGA"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(168,883 observations deleted)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>dat[origin<span class="sc">==</span><span class="st">'LGA'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       month   day  year dep_delay arr_delay carrier origin   dest air_time distance  hour
       &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;int&gt;     &lt;int&gt;  &lt;char&gt; &lt;char&gt; &lt;char&gt;    &lt;int&gt;    &lt;int&gt; &lt;int&gt;
    1:     6    23  2014        -5        83      WN    LGA    DEN      327     1620    15
    2:     5    11  2014        10        59      DL    LGA    DEN      294     1620    17
    3:     5    11  2014        59       115      WN    LGA    DEN      292     1620    18
    4:     1    31  2014        73       121      UA    LGA    DEN      291     1620    12
    5:     5    11  2014        70       138      UA    LGA    DEN      287     1620    16
   ---                                                                                    
84429:     7    15  2014        -7       -24      US    LGA    PHL       25       96     5
84430:     8    24  2014        -1       -16      US    LGA    PHL       25       96     5
84431:     9    28  2014        -4       -28      US    LGA    PHL       25       96    20
84432:     5    31  2014       -12       -17      US    LGA    BOS       23      184     7
84433:     6    20  2014        -6        -2      US    LGA    BOS       20      184    14</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> <span class="kw">if</span> <span class="fu">regexm</span>(origin,<span class="st">"LGA"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(168,883 observations deleted)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>dat[origin <span class="sc">%like%</span> <span class="st">'LGA'</span>] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       month   day  year dep_delay arr_delay carrier origin   dest air_time distance  hour
       &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;int&gt;     &lt;int&gt;  &lt;char&gt; &lt;char&gt; &lt;char&gt;    &lt;int&gt;    &lt;int&gt; &lt;int&gt;
    1:     6    23  2014        -5        83      WN    LGA    DEN      327     1620    15
    2:     5    11  2014        10        59      DL    LGA    DEN      294     1620    17
    3:     5    11  2014        59       115      WN    LGA    DEN      292     1620    18
    4:     1    31  2014        73       121      UA    LGA    DEN      291     1620    12
    5:     5    11  2014        70       138      UA    LGA    DEN      287     1620    16
   ---                                                                                    
84429:     7    15  2014        -7       -24      US    LGA    PHL       25       96     5
84430:     8    24  2014        -1       -16      US    LGA    PHL       25       96     5
84431:     9    28  2014        -4       -28      US    LGA    PHL       25       96    20
84432:     5    31  2014       -12       -17      US    LGA    BOS       23      184     7
84433:     6    20  2014        -6        -2      US    LGA    BOS       20      184    14</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> <span class="kw">if</span> <span class="fu">inlist</span>(<span class="fu">month</span>,3,4,11,12) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(201,305 observations deleted)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>dat[month <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">11</span>,<span class="dv">12</span>)] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       month   day  year dep_delay arr_delay carrier origin   dest air_time distance  hour
       &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;int&gt;     &lt;int&gt;  &lt;char&gt; &lt;char&gt; &lt;char&gt;    &lt;int&gt;    &lt;int&gt; &lt;int&gt;
    1:     3     2  2014        24        87      UA    EWR    HNL      706     4963     9
    2:     3     2  2014        -1        64      HA    JFK    HNL      704     4983     8
    3:     3     4  2014        -1        61      UA    EWR    HNL      697     4963     9
    4:     3     3  2014       -11        75      HA    JFK    HNL      690     4983     8
    5:     3    22  2014        -3        40      HA    JFK    HNL      689     4983     9
   ---                                                                                    
52007:     3     3  2014         9         7      EV    EWR    BDL       25      116    22
52008:     3     8  2014        -2         7      EV    EWR    BDL       25      116    18
52009:     3     3  2014         8       -18      EV    EWR    BDL       23      116     8
52010:     3     5  2014        -2       -27      EV    EWR    BDL       23      116     7
52011:     3     4  2014        17        -4      EV    EWR    BDL       21      116    22</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> <span class="kw">if</span> <span class="fu">inlist</span>(origin,<span class="st">"JFK"</span>,<span class="st">"LGA"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(87,400 observations deleted)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>dat[origin <span class="sc">%chin%</span> <span class="fu">c</span>(<span class="st">"JFK"</span>,<span class="st">"LGA"</span>)] <span class="co"># %chin% is a fast %in% for (ch)aracters </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        month   day  year dep_delay arr_delay carrier origin   dest air_time distance  hour
        &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;int&gt;     &lt;int&gt;  &lt;char&gt; &lt;char&gt; &lt;char&gt;    &lt;int&gt;    &lt;int&gt; &lt;int&gt;
     1:     3     2  2014        -1        64      HA    JFK    HNL      704     4983     8
     2:     3     3  2014       -11        75      HA    JFK    HNL      690     4983     8
     3:     3    22  2014        -3        40      HA    JFK    HNL      689     4983     9
     4:     2     7  2014         8        59      HA    JFK    HNL      685     4983     9
     5:     2    15  2014        -7        50      HA    JFK    HNL      682     4983     8
    ---                                                                                    
165912:     7    15  2014        -7       -24      US    LGA    PHL       25       96     5
165913:     8    24  2014        -1       -16      US    LGA    PHL       25       96     5
165914:     9    28  2014        -4       -28      US    LGA    PHL       25       96    20
165915:     5    31  2014       -12       -17      US    LGA    BOS       23      184     7
165916:     6    20  2014        -6        -2      US    LGA    BOS       20      184    14</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> <span class="kw">if</span> <span class="fu">month</span> == 1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(22,796 observations deleted)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>dat[month<span class="sc">!=</span><span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        month   day  year dep_delay arr_delay carrier origin   dest air_time distance  hour
        &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;int&gt;     &lt;int&gt;  &lt;char&gt; &lt;char&gt; &lt;char&gt;    &lt;int&gt;    &lt;int&gt; &lt;int&gt;
     1:     3     2  2014        24        87      UA    EWR    HNL      706     4963     9
     2:     3     2  2014        -1        64      HA    JFK    HNL      704     4983     8
     3:     3     4  2014        -1        61      UA    EWR    HNL      697     4963     9
     4:     3     3  2014       -11        75      HA    JFK    HNL      690     4983     8
     5:     3    22  2014        -3        40      HA    JFK    HNL      689     4983     9
    ---                                                                                    
230516:     6    26  2014        19        13      EV    EWR    BDL       21      116    13
230517:     9    11  2014        38        16      EV    EWR    BDL       21      116    23
230518:     9    13  2014        -4       -21      EV    EWR    BDL       21      116    20
230519:     2    21  2014        46        40      EV    EWR    BDL       20      116     9
230520:     6    20  2014        -6        -2      US    LGA    BOS       20      184    14</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="subset-columns" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="subset-columns">Subset columns</h3>
<div class="column-page-right">
<div class="split">
<div>
<p><em>Reminder: You’ll need to use <code>preserve/restore</code> if you want to retain the original dataset in the examples that follow.</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> <span class="fu">month</span> <span class="fu">day</span> carrier</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div>
<p><em>Reminder: You’ll need to (re)assign the subsetted dataset if you want to use it later, e.g.&nbsp;<code>dat1 = dat[...]</code>.</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>dat[, .(month, day, carrier)] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        month   day carrier
        &lt;int&gt; &lt;int&gt;  &lt;char&gt;
     1:     3     2      UA
     2:     3     2      HA
     3:     3     4      UA
     4:     3     3      HA
     5:     3    22      HA
    ---                    
253312:     6    26      EV
253313:     9    11      EV
253314:     9    13      EV
253315:     2    21      EV
253316:     6    20      US</code></pre>
</div>
</div>
</div>
<div>
&nbsp;
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>dat[, <span class="fu">list</span>(month, day, carrier)]    <span class="co"># another option</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>dat[, <span class="fu">c</span>(<span class="st">'month'</span>, <span class="st">'day'</span>, <span class="st">'carrier'</span>)] <span class="co"># and another</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="column-page-right">
<div class="split">
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> <span class="fu">year</span>-arr_delay</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>dat[, year<span class="sc">:</span>arr_delay] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         year dep_delay arr_delay
        &lt;int&gt;     &lt;int&gt;     &lt;int&gt;
     1:  2014        24        87
     2:  2014        -1        64
     3:  2014        -1        61
     4:  2014       -11        75
     5:  2014        -3        40
    ---                          
253312:  2014        19        13
253313:  2014        38        16
253314:  2014        -4       -21
253315:  2014        46        40
253316:  2014        -6        -2</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> *_delay</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>dat[, .SD, .SDcols<span class="ot">=</span><span class="fu">patterns</span>(<span class="st">'*_delay'</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        dep_delay arr_delay
            &lt;int&gt;     &lt;int&gt;
     1:        24        87
     2:        -1        64
     3:        -1        61
     4:       -11        75
     5:        -3        40
    ---                    
253312:        19        13
253313:        38        16
253314:        -4       -21
253315:        46        40
253316:        -6        -2</code></pre>
</div>
</div>
</div>
</div>
<div class="column-page-right">
<div class="split">
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> origin dest </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>dat[, <span class="sc">-</span><span class="fu">c</span>(<span class="st">'origin'</span>, <span class="st">'dest'</span>)]</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="do">## dat[, c('origin', 'dest') := NULL] # same, but in-place</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        month   day  year dep_delay arr_delay carrier air_time distance  hour
        &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;int&gt;     &lt;int&gt;  &lt;char&gt;    &lt;int&gt;    &lt;int&gt; &lt;int&gt;
     1:     3     2  2014        24        87      UA      706     4963     9
     2:     3     2  2014        -1        64      HA      704     4983     8
     3:     3     4  2014        -1        61      UA      697     4963     9
     4:     3     3  2014       -11        75      HA      690     4983     8
     5:     3    22  2014        -3        40      HA      689     4983     9
    ---                                                                      
253312:     6    26  2014        19        13      EV       21      116    13
253313:     9    11  2014        38        16      EV       21      116    23
253314:     9    13  2014        -4       -21      EV       21      116    20
253315:     2    21  2014        46        40      EV       20      116     9
253316:     6    20  2014        -6        -2      US       20      184    14</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="kw">ds</span>, has(<span class="dv">type</span> <span class="fu">string</span>) </span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="kw">drop</span> <span class="ot">`r(varlist)'</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>carrier  origin   dest</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Matches the two lines on the left:</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>dat[, .SD, .SDcols<span class="ot">=</span><span class="sc">!</span>is.character] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Index: &lt;month&gt;
        month   day  year dep_delay arr_delay air_time distance  hour
        &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;int&gt;     &lt;int&gt;    &lt;int&gt;    &lt;int&gt; &lt;int&gt;
     1:     3     2  2014        24        87      706     4963     9
     2:     3     2  2014        -1        64      704     4983     8
     3:     3     4  2014        -1        61      697     4963     9
     4:     3     3  2014       -11        75      690     4983     8
     5:     3    22  2014        -3        40      689     4983     9
    ---                                                              
253312:     6    26  2014        19        13       21      116    13
253313:     9    11  2014        38        16       21      116    23
253314:     9    13  2014        -4       -21       21      116    20
253315:     2    21  2014        46        40       20      116     9
253316:     6    20  2014        -6        -2       20      184    14</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="kw">ds</span>, has(<span class="dv">type</span> <span class="kw">int</span>) </span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> <span class="ot">`r(varlist)'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>year       dep_delay  arr_delay  air_time   distance</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Matches the two lines on the left: </span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>dat[, .SD, .SDcols<span class="ot">=</span>is.integer]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Index: &lt;month&gt;
        month   day  year dep_delay arr_delay air_time distance  hour
        &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;int&gt;     &lt;int&gt;    &lt;int&gt;    &lt;int&gt; &lt;int&gt;
     1:     3     2  2014        24        87      706     4963     9
     2:     3     2  2014        -1        64      704     4983     8
     3:     3     4  2014        -1        61      697     4963     9
     4:     3     3  2014       -11        75      690     4983     8
     5:     3    22  2014        -3        40      689     4983     9
    ---                                                              
253312:     6    26  2014        19        13       21      116    13
253313:     9    11  2014        38        16       21      116    23
253314:     9    13  2014        -4       -21       21      116    20
253315:     2    21  2014        46        40       20      116     9
253316:     6    20  2014        -6        -2       20      184    14</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="subset-rows-and-columns" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="subset-rows-and-columns">Subset rows and columns</h3>
<div class="column-page-right">
<div class="split">
<p><em>Reminder: You’ll need to use <code>preserve/restore</code> if you want to retain the original dataset in the examples that follow.</em></p>
<p><em>Reminder: You’ll need to (re)assign the subsetted dataset if you want to use it later, e.g.&nbsp;<code>dat1 = dat[...]</code>.</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> <span class="kw">if</span> origin == <span class="st">"LGA"</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> <span class="fu">month</span> <span class="fu">day</span> carrier</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(168,883 observations deleted)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Matches the two lines on the left:</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>dat[origin<span class="sc">==</span><span class="st">"LGA"</span>, .(month, day, carrier)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       month   day carrier
       &lt;int&gt; &lt;int&gt;  &lt;char&gt;
    1:     6    23      WN
    2:     5    11      DL
    3:     5    11      WN
    4:     1    31      UA
    5:     5    11      UA
   ---                    
84429:     7    15      US
84430:     8    24      US
84431:     9    28      US
84432:     5    31      US
84433:     6    20      US</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="drop-duplicates" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="drop-duplicates">Drop duplicates</h3>
<div class="column-page-right">
<div class="split">
<p><em>Reminder: You’ll need to use <code>preserve/restore</code> if you want to retain the original dataset in the examples that follow.</em></p>
<p><em>Reminder: You’ll need to (re)assign the subsetted dataset if you want to use it later, e.g.&nbsp;<code>dat1 = dat[...]</code>.</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="kw">duplicates</span> <span class="kw">drop</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Duplicates in terms of all variables

(1 observation deleted)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        month   day  year dep_delay arr_delay carrier origin   dest air_time distance  hour
        &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;int&gt;     &lt;int&gt;  &lt;char&gt; &lt;char&gt; &lt;char&gt;    &lt;int&gt;    &lt;int&gt; &lt;int&gt;
     1:     3     2  2014        24        87      UA    EWR    HNL      706     4963     9
     2:     3     2  2014        -1        64      HA    JFK    HNL      704     4983     8
     3:     3     4  2014        -1        61      UA    EWR    HNL      697     4963     9
     4:     3     3  2014       -11        75      HA    JFK    HNL      690     4983     8
     5:     3    22  2014        -3        40      HA    JFK    HNL      689     4983     9
    ---                                                                                    
253311:     6    26  2014        19        13      EV    EWR    BDL       21      116    13
253312:     9    11  2014        38        16      EV    EWR    BDL       21      116    23
253313:     9    13  2014        -4       -21      EV    EWR    BDL       21      116    20
253314:     2    21  2014        46        40      EV    EWR    BDL       20      116     9
253315:     6    20  2014        -6        -2      US    LGA    BOS       20      184    14</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="kw">duplicates</span> <span class="kw">drop</span> <span class="fu">month</span> <span class="fu">day</span> carrier, <span class="kw">force</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Duplicates in terms of month day carrier

(249,378 observations deleted)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(dat, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'month'</span>, <span class="st">'day'</span>, <span class="st">'carrier'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      month   day  year dep_delay arr_delay carrier origin   dest air_time distance  hour
      &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;int&gt;     &lt;int&gt;  &lt;char&gt; &lt;char&gt; &lt;char&gt;    &lt;int&gt;    &lt;int&gt; &lt;int&gt;
   1:     3     2  2014        24        87      UA    EWR    HNL      706     4963     9
   2:     3     2  2014        -1        64      HA    JFK    HNL      704     4983     8
   3:     3     4  2014        -1        61      UA    EWR    HNL      697     4963     9
   4:     3     3  2014       -11        75      HA    JFK    HNL      690     4983     8
   5:     3    22  2014        -3        40      HA    JFK    HNL      689     4983     9
  ---                                                                                    
3934:     3    18  2014         4        17      OO    LGA    CLE       71      419     9
3935:     3    25  2014         3       -20      OO    LGA    CLE       70      419     9
3936:     2    12  2014         4        -4      FL    LGA    CAK       68      397    20
3937:     2    13  2014       150       120      EV    LGA    CLE       63      419    19
3938:     3    31  2014        56        50      OO    LGA    CLE       62      419    10</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="drop-missing" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="drop-missing">Drop missing</h3>
<div class="column-page-right">
<div class="split">
<div>
<p><em>Reminder: You’ll need to use <code>preserve/restore</code> if you want to retain the original dataset in the examples that follow.</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="kw">keep</span> <span class="kw">if</span> !<span class="fu">missing</span>(dest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(0 observations deleted)</code></pre>
</div>
</div>
</div>
<div>
<p><em>Reminder: You’ll need to (re)assign the subsetted dataset if you want to use it later, e.g.&nbsp;<code>dat1 = dat[...]</code>.</em></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>dat[<span class="sc">!</span><span class="fu">is.na</span>(dest)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        month   day  year dep_delay arr_delay carrier origin   dest air_time distance  hour
        &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;int&gt;     &lt;int&gt;  &lt;char&gt; &lt;char&gt; &lt;char&gt;    &lt;int&gt;    &lt;int&gt; &lt;int&gt;
     1:     3     2  2014        24        87      UA    EWR    HNL      706     4963     9
     2:     3     2  2014        -1        64      HA    JFK    HNL      704     4983     8
     3:     3     4  2014        -1        61      UA    EWR    HNL      697     4963     9
     4:     3     3  2014       -11        75      HA    JFK    HNL      690     4983     8
     5:     3    22  2014        -3        40      HA    JFK    HNL      689     4983     9
    ---                                                                                    
253312:     6    26  2014        19        13      EV    EWR    BDL       21      116    13
253313:     9    11  2014        38        16      EV    EWR    BDL       21      116    23
253314:     9    13  2014        -4       -21      EV    EWR    BDL       21      116    20
253315:     2    21  2014        46        40      EV    EWR    BDL       20      116     9
253316:     6    20  2014        -6        -2      US    LGA    BOS       20      184    14</code></pre>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>* Requires: <span class="kw">ssc</span> inst missings</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>missings dropvars, <span class="kw">force</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Checking missings in year month day dep_delay arr_delay carrier origin dest air_time distance hour:
0 observations with missing values

note: no variables qualify</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">na.omit</span>(dat) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Indices: &lt;origin&gt;, &lt;month&gt;
        month   day  year dep_delay arr_delay carrier origin   dest air_time distance  hour
        &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;int&gt;     &lt;int&gt;  &lt;char&gt; &lt;char&gt; &lt;char&gt;    &lt;int&gt;    &lt;int&gt; &lt;int&gt;
     1:     3     2  2014        24        87      UA    EWR    HNL      706     4963     9
     2:     3     2  2014        -1        64      HA    JFK    HNL      704     4983     8
     3:     3     4  2014        -1        61      UA    EWR    HNL      697     4963     9
     4:     3     3  2014       -11        75      HA    JFK    HNL      690     4983     8
     5:     3    22  2014        -3        40      HA    JFK    HNL      689     4983     9
    ---                                                                                    
253312:     6    26  2014        19        13      EV    EWR    BDL       21      116    13
253313:     9    11  2014        38        16      EV    EWR    BDL       21      116    23
253314:     9    13  2014        -4       -21      EV    EWR    BDL       21      116    20
253315:     2    21  2014        46        40      EV    EWR    BDL       20      116     9
253316:     6    20  2014        -6        -2      US    LGA    BOS       20      184    14</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>missings air_time dest, <span class="kw">force</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>illegal missings subcommand
r(198);

r(198);</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">na.omit</span>(dat, <span class="at">cols =</span> <span class="fu">c</span>(<span class="st">'air_time'</span>, <span class="st">'dest'</span>)) </span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="co"># dat[!is.na(air_time) &amp; !is.na(dest)] # same</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Indices: &lt;origin&gt;, &lt;month&gt;
        month   day  year dep_delay arr_delay carrier origin   dest air_time distance  hour
        &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;int&gt;     &lt;int&gt;  &lt;char&gt; &lt;char&gt; &lt;char&gt;    &lt;int&gt;    &lt;int&gt; &lt;int&gt;
     1:     3     2  2014        24        87      UA    EWR    HNL      706     4963     9
     2:     3     2  2014        -1        64      HA    JFK    HNL      704     4983     8
     3:     3     4  2014        -1        61      UA    EWR    HNL      697     4963     9
     4:     3     3  2014       -11        75      HA    JFK    HNL      690     4983     8
     5:     3    22  2014        -3        40      HA    JFK    HNL      689     4983     9
    ---                                                                                    
253312:     6    26  2014        19        13      EV    EWR    BDL       21      116    13
253313:     9    11  2014        38        16      EV    EWR    BDL       21      116    23
253314:     9    13  2014        -4       -21      EV    EWR    BDL       21      116    20
253315:     2    21  2014        46        40      EV    EWR    BDL       20      116     9
253316:     6    20  2014        -6        -2      US    LGA    BOS       20      184    14</code></pre>
</div>
</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<div class="toc-actions" id="output-code-toggler">
	<ul>
		<li>
			<div class="toggle form-check">
				<input class="form-check-input" type="checkbox" checked="" id="toggle-output-checkbox" style="margin-right: 0.4em; font-size: 0.8rem">
				<label class="form-check-label" for="toggle-code-checkbox">Show Output</label>
			</div>
		</li>
	</ul>
</div>

<script>
	window.document.addEventListener("DOMContentLoaded", function (event) {
		const outputToggler = window.document.getElementById(
			"output-code-toggler"
		)
		const hasTOC = !(
			window.document.querySelector("#quarto-margin-sidebar #TOC") === null
		)
		const hasOutputCells =
			document.querySelectorAll(".cell > .cell-output").length > 0

		// Delete if there are no source code cells
		if (!hasOutputCells) {
			outputToggler.remove()
			return
		}

		// Create TOC if it doesn't exist
		if (!hasTOC) {
			const tocElement = window.document.createElement("nav")
			tocElement.id = "TOC"
			tocElement.setAttribute("role", "doc-toc")
			tocElement.classList.add("toc-active")
			window.document
				.querySelector("#quarto-margin-sidebar")
				.appendChild(tocElement)
		}

		// Move into `#TOC`
		window.document
			.querySelector("#quarto-sidebar #TOC")
			.appendChild(outputToggler)

		// Make toggle interactive
		function toggleCellOutputDivs() {
			const cellOutputDivs = document.querySelectorAll(".cell > .cell-output")
			const toggleCodeCheckbox = document.getElementById("toggle-output-checkbox")

			for (let i = 0; i < cellOutputDivs.length; i++) {
				if (toggleCodeCheckbox.checked) {
					cellOutputDivs[i].classList.remove("hidden")
				} else {
					cellOutputDivs[i].classList.add("hidden")
				}
			}
		}

		const toggleOutputCheckbox = document.getElementById("toggle-output-checkbox")
		if (toggleOutputCheckbox) {
			toggleOutputCheckbox.addEventListener("change", toggleCellOutputDivs)
		}
	})
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>